!function(e){"$:nomunge";function t(e){return"string"==typeof e}function n(e){var t=x.call(arguments,1);return function(){return e.apply(this,t.concat(x.call(arguments)))}}function r(e){return e.replace(h,"$2")}function o(e){return e.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function i(n,r,o,i,a){var s,c,p,d,g;return i!==u?(p=o.match(n?h:/^([^#?]*)\??([^#]*)(#?.*)/),g=p[3]||"",2===a&&t(i)?c=i.replace(n?m:T,""):(d=f(p[2]),i=t(i)?f[n?N:P](i):i,c=2===a?i:1===a?e.extend({},i,d):e.extend({},d,i),c=l(c),n&&(c=c.replace(b,A))),s=p[1]+(n?w:c||!p[1]?"?":"")+c+g):s=r(o!==u?o:location.href),s}function a(e,n,r){return n===u||"boolean"==typeof n?(r=n,n=_[e?N:P]()):n=t(n)?n.replace(e?m:T,""):n,f(n,r)}function s(n,r,o,i){return t(o)||"object"==typeof o||(i=o,o=r,r=u),this.each(function(){var t=e(this),a=r||y()[(this.nodeName||"").toLowerCase()]||"",s=a&&t.attr(a)||"";t.attr(a,_[n](s,o,i))})}var u,l,c,f,p,d,g,y,m,h,b,v,w,x=Array.prototype.slice,A=decodeURIComponent,_=e.param,j=e.bbq=e.bbq||{},k=e.event.special,E="hashchange",P="querystring",N="fragment",S="elemUrlAttr",C="href",M="src",T=/^.*\?|#.*$/g,L={};_[P]=n(i,0,o),_[N]=c=n(i,1,r),_.sorted=l=function(t,n){var r=[],o={};return e.each(_(t,n).split("&"),function(e,t){var n=t.replace(/(?:%5B|=).*$/,""),i=o[n];i||(i=o[n]=[],r.push(n)),i.push(t)}),e.map(r.sort(),function(e){return o[e]}).join("&")},c.noEscape=function(t){t=t||"";var n=e.map(t.split(""),encodeURIComponent);b=new RegExp(n.join("|"),"g")},c.noEscape(",/"),c.ajaxCrawlable=function(e){return e!==u&&(e?(m=/^.*(?:#!|#)/,h=/^([^#]*)(?:#!|#)?(.*)$/,w="#!"):(m=/^.*#/,h=/^([^#]*)#?(.*)$/,w="#"),v=!!e),v},c.ajaxCrawlable(0),e.deparam=f=function(t,n){var r={},o={"true":!0,"false":!1,"null":null};return e.each(t.replace(/\+/g," ").split("&"),function(t,i){var a,s=i.split("="),l=A(s[0]),c=r,f=0,p=l.split("]["),d=p.length-1;if(/\[/.test(p[0])&&/\]$/.test(p[d])?(p[d]=p[d].replace(/\]$/,""),p=p.shift().split("[").concat(p),d=p.length-1):d=0,2===s.length)if(a=A(s[1]),n&&(a=a&&!isNaN(a)?+a:"undefined"===a?u:o[a]!==u?o[a]:a),d)for(;d>=f;f++)l=""===p[f]?c.length:p[f],c=c[l]=d>f?c[l]||(p[f+1]&&isNaN(p[f+1])?{}:[]):a;else e.isArray(r[l])?r[l].push(a):r[l]=r[l]!==u?[r[l],a]:a;else l&&(r[l]=n?u:"")}),r},f[P]=n(a,0),f[N]=p=n(a,1),e[S]||(e[S]=function(t){return e.extend(L,t)})({a:C,base:C,iframe:M,img:M,input:M,form:"action",link:C,script:M}),y=e[S],e.fn[P]=n(s,P),e.fn[N]=n(s,N),j.pushState=d=function(e,n){t(e)&&/^#/.test(e)&&n===u&&(n=2);var r=e!==u,o=c(location.href,r?e:{},r?n:2);location.href=o},j.getState=g=function(e,t){return e===u||"boolean"==typeof e?p(e):p(t)[e]},j.removeState=function(t){var n={};t!==u&&(n=g(),e.each(e.isArray(t)?t:arguments,function(e,t){delete n[t]})),d(n,2)},k[E]=e.extend(k[E],{add:function(t){function n(e){var t=e[N]=c();e.getState=function(e,n){return e===u||"boolean"==typeof e?f(t,e):f(t,n)[e]},r.apply(this,arguments)}var r;return e.isFunction(t)?(r=t,n):(r=t.handler,void(t.handler=n))}})}(jQuery,this),function(e,t,n){"$:nomunge";function r(e){return e=e||location.href,"#"+e.replace(/^[^#]*#?(.*)$/,"$1")}var o,i="hashchange",a=document,s=e.event.special,u=a.documentMode,l="on"+i in t&&(u===n||u>7);e.fn[i]=function(e){return e?this.bind(i,e):this.trigger(i)},e.fn[i].delay=50,s[i]=e.extend(s[i],{setup:function(){return l?!1:void e(o.start)},teardown:function(){return l?!1:void e(o.stop)}}),o=function(){function o(){var n=r(),a=d(c);n!==c?(p(c=n,a),e(t).trigger(i)):a!==c&&(location.href=location.href.replace(/#.*/,"")+a),s=setTimeout(o,e.fn[i].delay)}var s,u={},c=r(),f=function(e){return e},p=f,d=f;return u.start=function(){s||o()},u.stop=function(){s&&clearTimeout(s),s=n},e.browser.msie&&!l&&function(){var t,n;u.start=function(){t||(n=e.fn[i].src,n=n&&n+r(),t=e('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){n||p(r()),o()}).attr("src",n||"javascript:0").insertAfter("body")[0].contentWindow,a.onpropertychange=function(){try{"title"===event.propertyName&&(t.document.title=a.title)}catch(e){}})},u.stop=f,d=function(){return r(t.location.href)},p=function(n,r){var o=t.document,s=e.fn[i].domain;n!==r&&(o.title=a.title,o.open(),s&&o.write('<script>document.domain="'+s+'"</script>'),o.close(),t.location.hash=n)}}(),u}()}(jQuery,this),function(e,t){L.AwesomeMarkers={},L.AwesomeMarkers.version="1.0",L.AwesomeMarkers.Icon=L.Icon.extend({options:{iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[1,-32],shadowAnchor:[10,12],shadowSize:[36,16],className:"awesome-marker",icon:"home",color:"blue",iconColor:"white"},initialize:function(e){e=L.setOptions(this,e)},createIcon:function(){var e=t.createElement("div"),n=this.options;return n.icon&&(e.innerHTML=this._createInner()),n.bgPos&&(e.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),this._setIconStyles(e,"icon-"+n.color),e},_createInner:function(){var e;return e="icon-"===this.options.icon.slice(0,5)?this.options.icon:"icon-"+this.options.icon,"<i class='"+e+(this.options.spin?" icon-spin":"")+(this.options.iconColor?" icon-"+this.options.iconColor:"")+"'></i>"},_setIconStyles:function(e,t){var n,r=this.options,o=L.point(r["shadow"==t?"shadowSize":"iconSize"]);n=L.point("shadow"===t?r.shadowAnchor||r.iconAnchor:r.iconAnchor),!n&&o&&(n=o.divideBy(2,!0)),e.className="awesome-marker-"+t+" "+r.className,n&&(e.style.marginLeft=-n.x+"px",e.style.marginTop=-n.y+"px"),o&&(e.style.width=o.x+"px",e.style.height=o.y+"px")},createShadow:function(){{var e=t.createElement("div");this.options}return this._setIconStyles(e,"shadow"),e}}),L.AwesomeMarkers.icon=function(e){return new L.AwesomeMarkers.Icon(e)}}(this,document),L.SpinMapMixin={spin:function(e){var e=!!e;e?(this._spinner||(this._spinner=(new Spinner).spin(this._container),this._spinning=0),this._spinning++):(this._spinning--,this._spinning<=0&&this._spinner&&(this._spinner.stop(),this._spinner=null))}},L.Map.include(L.SpinMapMixin),L.Map.addInitHook(function(){this.on("layeradd",function(e){e.layer.loading&&this.spin(!0),"function"==typeof e.layer.on&&(e.layer.on("data:loading",function(){this.spin(!0)},this),e.layer.on("data:loaded",function(){this.spin(!1)},this))},this),this.on("layerremove",function(e){e.layer.loading&&this.spin(!1),"function"==typeof e.layer.on&&(e.layer.off("data:loaded"),e.layer.off("data:loading"))},this)}),!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.osmtogeojson=e()}}(function(){return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t){var n=e("./lodash.custom.js"),r=e("geojson-rewind"),o=e("./polygon_features.json"),i={};i=function(e,t){function i(e){function t(e){var t=n.clone(e);t.lat=e.center.lat,t.lon=e.center.lon,t.__is_center_placeholder=!0,a.push(t)}function r(e){function t(e,t,n){var o={type:"node",id:"_"+r.type+"/"+r.id+"bounds"+n,lat:e,lon:t};r.nodes.push(o.id),a.push(o)}var r=n.clone(e);r.nodes=[],t(r.bounds.minlat,r.bounds.minlon,1),t(r.bounds.maxlat,r.bounds.minlon,2),t(r.bounds.maxlat,r.bounds.maxlon,3),t(r.bounds.minlat,r.bounds.maxlon,4),r.nodes.push(r.nodes[0]),r.__is_bounds_placeholder=!0,u.push(r)}function o(e){function t(e,t,n){var r={type:"node",id:n,lat:e,lon:t};a.push(r)}n.isArray(e.nodes)||(e.nodes=e.geometry.map(function(e){return null!==e?"_anonymous@"+e.lat+"/"+e.lon:"_anonymous@unknown_location"})),e.geometry.forEach(function(n,r){n&&t(n.lat,n.lon,e.nodes[r])})}function i(e){function t(e,t,n){var r={type:"node",id:n,lat:e,lon:t};a.push(r)}function n(e,t){function n(e,t){var n={type:"node",id:"_anonymous@"+e+"/"+t,lat:e,lon:t};r.nodes.push(n.id),a.push(n)}if(!u.some(function(e){return"way"==e.type&&e.id==t})){var r={type:"way",id:t,nodes:[]};e.forEach(function(e){e?n(e.lat,e.lon):r.nodes.push(void 0)}),u.push(r)}}e.members.forEach(function(e){"node"==e.type?e.lat&&t(e.lat,e.lon,e.ref):"way"==e.type&&e.geometry&&n(e.geometry,e.ref)})}for(var a=new Array,u=new Array,l=new Array,c=0;c<e.elements.length;c++)switch(e.elements[c].type){case"node":var f=e.elements[c];a.push(f);break;case"way":var p=n.clone(e.elements[c]);p.nodes=n.clone(p.nodes),u.push(p),p.center&&t(p),p.geometry?o(p):p.bounds&&r(p);break;case"relation":var d=n.clone(e.elements[c]);d.members=n.clone(d.members),l.push(d);var g=d.members&&d.members.some(function(e){return"node"==e.type&&e.lat||"way"==e.type&&e.geometry});d.center&&t(d),g?i(d):d.bounds&&r(d)}return s(a,u,l)}function a(e){function t(e,t,n){e.hasAttribute(n)&&(t[n]=e.getAttribute(n))}function r(e,r){var o=n.clone(e);t(r,o,"lat"),t(r,o,"lon"),o.__is_center_placeholder=!0,u.push(o)}function o(e,t){function r(e,t,n){var r={type:"node",id:"_"+o.type+"/"+o.id+"bounds"+n,lat:e,lon:t};o.nodes.push(r.id),u.push(r)}var o=n.clone(e);o.nodes=[],r(t.getAttribute("minlat"),t.getAttribute("minlon"),1),r(t.getAttribute("maxlat"),t.getAttribute("minlon"),2),r(t.getAttribute("maxlat"),t.getAttribute("maxlon"),3),r(t.getAttribute("minlat"),t.getAttribute("maxlon"),4),o.nodes.push(o.nodes[0]),o.__is_bounds_placeholder=!0,l.push(o)}function i(e,t){function r(e,t,n){var r={type:"node",id:n,lat:e,lon:t};return u.push(r),r.id}n.isArray(e.nodes)||(e.nodes=[],n.each(t,function(t){e.nodes.push("_anonymous@"+t.getAttribute("lat")+"/"+t.getAttribute("lon"))})),n.each(t,function(t,n){t.getAttribute("lat")&&r(t.getAttribute("lat"),t.getAttribute("lon"),e.nodes[n])})}function a(e,t){function r(e,t,n){var r={type:"node",id:n,lat:e,lon:t};u.push(r)}function o(e,t){function r(e,t){var n={type:"node",id:"_anonymous@"+e+"/"+t,lat:e,lon:t};o.nodes.push(n.id),u.push(n)}if(!l.some(function(e){return"way"==e.type&&e.id==t})){var o={type:"way",id:t,nodes:[]};n.each(e,function(e){e.getAttribute("lat")?r(e.getAttribute("lat"),e.getAttribute("lon")):o.nodes.push(void 0)}),l.push(o)}}n.each(t,function(t,n){"node"==e.members[n].type?t.getAttribute("lat")&&r(t.getAttribute("lat"),t.getAttribute("lon"),e.members[n].ref):"way"==e.members[n].type&&t.getElementsByTagName("nd").length>0&&o(t.getElementsByTagName("nd"),e.members[n].ref)})}var u=new Array,l=new Array,c=new Array;n.each(e.getElementsByTagName("node"),function(e){var r={};n.each(e.getElementsByTagName("tag"),function(e){r[e.getAttribute("k")]=e.getAttribute("v")});var o={type:"node"};t(e,o,"id"),t(e,o,"lat"),t(e,o,"lon"),t(e,o,"version"),t(e,o,"timestamp"),t(e,o,"changeset"),t(e,o,"uid"),t(e,o,"user"),n.isEmpty(r)||(o.tags=r),u.push(o)});var f,p;return n.each(e.getElementsByTagName("way"),function(e){var a={},s=[];n.each(e.getElementsByTagName("tag"),function(e){a[e.getAttribute("k")]=e.getAttribute("v")});var u=!1;n.each(e.getElementsByTagName("nd"),function(e,t){var n;(n=e.getAttribute("ref"))&&(s[t]=n),!u&&e.getAttribute("lat")&&(u=!0)});var c={type:"way"};t(e,c,"id"),t(e,c,"version"),t(e,c,"timestamp"),t(e,c,"changeset"),t(e,c,"uid"),t(e,c,"user"),s.length>0&&(c.nodes=s),n.isEmpty(a)||(c.tags=a),(f=e.getElementsByTagName("center")[0])&&r(c,f),u?i(c,e.getElementsByTagName("nd")):(p=e.getElementsByTagName("bounds")[0])&&o(c,p),l.push(c)}),n.each(e.getElementsByTagName("relation"),function(e){var i={},s=[];n.each(e.getElementsByTagName("tag"),function(e){i[e.getAttribute("k")]=e.getAttribute("v")});var u=!1;n.each(e.getElementsByTagName("member"),function(e,n){s[n]={},t(e,s[n],"ref"),t(e,s[n],"role"),t(e,s[n],"type"),(!u&&"node"==s[n].type&&e.getAttribute("lat")||"way"==s[n].type&&e.getElementsByTagName("nd").length>0)&&(u=!0)});var l={type:"relation"};t(e,l,"id"),t(e,l,"version"),t(e,l,"timestamp"),t(e,l,"changeset"),t(e,l,"uid"),t(e,l,"user"),s.length>0&&(l.members=s),n.isEmpty(i)||(l.tags=i),(f=e.getElementsByTagName("center")[0])&&r(l,f),u?a(l,e.getElementsByTagName("member")):(p=e.getElementsByTagName("bounds")[0])&&o(l,p),c.push(l)}),s(u,l,c)}function s(e,o,i){function a(e,n){if("object"!=typeof n&&(n={}),"function"==typeof t.uninterestingTags)return!t.uninterestingTags(e,n);for(var r in e)if(t.uninterestingTags[r]!==!0&&n[r]!==!0&&n[r]!==e[r])return!0;return!1}function s(e){var t={timestamp:e.timestamp,version:e.version,changeset:e.changeset,user:e.user,uid:e.uid};for(k in t)void 0===t[k]&&delete t[k];return t}function l(e,r){function o(n){for(var r,o,i,a,s,u,c=function(e){return e[0]},f=function(e){return e[e.length-1]},p=[];n.length;)for(r=n.pop().nodes.slice(),p.push(r);n.length&&c(r)!==f(r);){for(o=c(r),i=f(r),a=0;a<n.length;a++){if(u=n[a].nodes,i===c(u)){s=r.push,u=u.slice(1);break}if(i===f(u)){s=r.push,u=u.slice(0,-1).reverse();break}if(o==f(u)){s=r.unshift,u=u.slice(0,-1);break}if(o==c(u)){s=r.unshift,u=u.slice(1).reverse();break}u=s=null}if(!u){t.verbose&&console.warn("Multipolygon",l+"/"+e.id,"contains unclosed ring geometry");break}n.splice(a,1),s.apply(r,u)}return p}function i(e){var t,n,r=function(e,t){for(var n=0;n<t.length;n++)if(i(t[n],e))return!0;return!1},o=function(e){return e.map(function(e){return[+e.lat,+e.lon]})},i=function(e,t){for(var n=e[0],r=e[1],o=!1,i=0,a=t.length-1;i<t.length;a=i++){var s=t[i][0],u=t[i][1],l=t[a][0],c=t[a][1],f=u>r!=c>r&&(l-s)*(r-u)/(c-u)+s>n;f&&(o=!o)}return o};for(e=o(e),t=0;t<c.length;t++)if(n=o(c[t]),r(n,e))return t}var a,u=!1,l=S?"way":"relation";a=r.members.filter(function(e){return"way"===e.type}),a=a.map(function(n){var r=g[n.ref];return void 0===r?(t.verbose&&console.warn("Multipolygon",l+"/"+e.id,"tainted by a missing way",n.type+"/"+n.ref),void(u=!0)):{id:n.ref,role:n.role||"outer",way:r,nodes:r.nodes.filter(function(r){return void 0!==r?!0:(u=!0,t.verbose&&console.warn("Multipolygon",l+"/"+e.id,"tainted by a way",n.type+"/"+n.ref,"with a missing node"),!1)})}}),a=n.compact(a);var c,f;c=o(a.filter(function(e){return"outer"===e.role})),f=o(a.filter(function(e){return"inner"===e.role}));var p;p=c.map(function(e){return[e]});for(var d=0;d<f.length;d++){var y=i(f[d]);void 0!==y?p[y].push(f[d]):t.verbose&&console.warn("Multipolygon",l+"/"+e.id,"contains an inner ring with no containing outer")}var m=[];if(m=n.compact(p.map(function(r){var o=n.compact(r.map(function(r){return r.length<4?void(t.verbose&&console.warn("Multipolygon",l+"/"+e.id,"contains a ring with less than four nodes")):n.compact(r.map(function(e){return[+e.lon,+e.lat]}))}));return 0==o.length?void(t.verbose&&console.warn("Multipolygon",l+"/"+e.id,"contains an empty ring cluster")):o})),0==m.length)return t.verbose&&console.warn("Multipolygon",l+"/"+e.id,"contains no coordinates"),!1;var h="MultiPolygon";1===m.length&&(h="Polygon",m=m[0]);var v={type:"Feature",id:e.type+"/"+e.id,properties:{type:e.type,id:e.id,tags:e.tags||{},relations:b[e.type][e.id]||[],meta:s(e)},geometry:{type:h,coordinates:m}};return u&&(t.verbose&&console.warn("Multipolygon",l+"/"+e.id,"is tainted"),v.properties.tainted=!0),v}for(var c=new Object,f=0;f<e.length;f++)void 0!==e[f].lat?c[e[f].id]=e[f]:t.verbose&&console.warn("Node",e[f].type+"/"+e[f].id,"ignored because it has no coordinates");for(var p=new Object,f=0;f<e.length;f++)"undefined"!=typeof e[f].tags&&a(e[f].tags)&&(p[e[f].id]=!0);for(var f=0;f<i.length;f++)if(n.isArray(i[f].members))for(var d=0;d<i[f].members.length;d++)"node"==i[f].members[d].type&&(p[i[f].members[d].ref]=!0);else t.verbose&&console.warn("Relation",i[f].type+"/"+i[f].id,"ignored because it has no members");for(var g=new Object,y=new Object,f=0;f<o.length;f++)if(n.isArray(o[f].nodes)){g[o[f].id]=o[f];for(var d=0;d<o[f].nodes.length;d++)y[o[f].nodes[d]]=!0,o[f].nodes[d]=c[o[f].nodes[d]]}else t.verbose&&console.warn("Way",o[f].type+"/"+o[f].id,"ignored because it has no nodes");for(var m=new Array,f=0;f<e.length;f++)(!y[e[f].id]||p[e[f].id])&&m.push(e[f]);for(var h=new Array,f=0;f<i.length;f++)n.isArray(i[f].members)?h[i[f].id]=i[f]:t.verbose&&console.warn("Relation",i[f].type+"/"+i[f].id,"ignored because it has no members");for(var b={node:{},way:{},relation:{}},f=0;f<i.length;f++)if(n.isArray(i[f].members))for(var d=0;d<i[f].members.length;d++){var v;switch(i[f].members[d].type){case"node":v=c[i[f].members[d].ref];break;case"way":v=g[i[f].members[d].ref];break;case"relation":v=h[i[f].members[d].ref]}if(v){var w=i[f].members[d].type,x=i[f].members[d].ref;"undefined"==typeof b[w][x]&&(b[w][x]=[]),b[w][x].push({role:i[f].members[d].role,rel:i[f].id,reltags:i[f].tags})}else t.verbose&&console.warn("Relation",i[f].type+"/"+i[f].id,"member",i[f].members[d].type+"/"+i[f].members[d].id,"ignored because it has an invalid type")}else t.verbose&&console.warn("Relation",i[f].type+"/"+i[f].id,"ignored because it has no members");var A,_={type:"FeatureCollection",features:new Array};for(f=0;f<m.length;f++)if("undefined"!=typeof m[f].lon&&"undefined"!=typeof m[f].lat){var j={type:"Feature",id:m[f].type+"/"+m[f].id,properties:{type:m[f].type,id:m[f].id,tags:m[f].tags||{},relations:b.node[m[f].id]||[],meta:s(m[f])},geometry:{type:"Point",coordinates:[+m[f].lon,+m[f].lat]}};m[f].__is_center_placeholder&&(j.properties.geometry="center"),_.features.push(j)}else t.verbose&&console.warn("POI",m[f].type+"/"+m[f].id,"ignored because it lacks coordinates");for(var E={type:"FeatureCollection",features:new Array},P={type:"FeatureCollection",features:new Array},f=0;f<i.length;f++)if("undefined"!=typeof i[f].tags&&("multipolygon"==i[f].tags.type||"boundary"==i[f].tags.type)){if(!n.isArray(i[f].members)){t.verbose&&console.warn("Multipolygon",i[f].type+"/"+i[f].id,"ignored because it has no members");continue}for(var N=0,d=0;d<i[f].members.length;d++)"outer"==i[f].members[d].role?N++:t.verbose&&"inner"!=i[f].members[d].role&&console.warn("Multipolygon",i[f].type+"/"+i[f].id,"member",i[f].members[d].type+"/"+i[f].members[d].ref,'ignored because it has an invalid role: "'+i[f].members[d].role+'"');if(i[f].members.forEach(function(e){g[e.ref]&&("outer"!==e.role||a(g[e.ref].tags,i[f].tags)||(g[e.ref].is_multipolygon_outline=!0),"inner"!==e.role||a(g[e.ref].tags)||(g[e.ref].is_multipolygon_outline=!0))}),0==N){t.verbose&&console.warn("Multipolygon relation",i[f].type+"/"+i[f].id,"ignored because it has no outer ways");continue}var S=!1;1!=N||a(i[f].tags,{type:!0})||(S=!0);var j=null;if(S){var C=i[f].members.filter(function(e){return"outer"===e.role})[0];if(C=g[C.ref],void 0===C){t.verbose&&console.warn("Multipolygon relation",i[f].type+"/"+i[f].id,"ignored because outer way",C.type+"/"+C.ref,"is missing");continue}C.is_multipolygon_outline=!0,j=l(C,i[f])}else j=l(i[f],i[f]);if(j===!1){t.verbose&&console.warn("Multipolygon relation",i[f].type+"/"+i[f].id,"ignored because it has invalid geometry");continue}P.features.push(j)}for(var f=0;f<o.length;f++)if(n.isArray(o[f].nodes)){if(!o[f].is_multipolygon_outline){for(o[f].tainted=!1,o[f].hidden=!1,coords=new Array,d=0;d<o[f].nodes.length;d++)"object"==typeof o[f].nodes[d]?coords.push([+o[f].nodes[d].lon,+o[f].nodes[d].lat]):(t.verbose&&console.warn("Way",o[f].type+"/"+o[f].id,"is tainted by an invalid node"),o[f].tainted=!0);if(coords.length<=1)t.verbose&&console.warn("Way",o[f].type+"/"+o[f].id,"ignored because it contains too few nodes");else{var M="LineString";"undefined"!=typeof o[f].nodes[0]&&o[f].nodes[0]===o[f].nodes[o[f].nodes.length-1]&&("undefined"!=typeof o[f].tags&&u(o[f].tags)||o[f].__is_bounds_placeholder)&&(M="Polygon",coords=[coords]);var j={type:"Feature",id:o[f].type+"/"+o[f].id,properties:{type:o[f].type,id:o[f].id,tags:o[f].tags||{},relations:b.way[o[f].id]||[],meta:s(o[f])},geometry:{type:M,coordinates:coords}};o[f].tainted&&(t.verbose&&console.warn("Way",o[f].type+"/"+o[f].id,"is tainted"),j.properties.tainted=!0),o[f].__is_bounds_placeholder&&(j.properties.geometry="bounds"),"LineString"==M?E.features.push(j):P.features.push(j)}}}else t.verbose&&console.warn("Way",o[f].type+"/"+o[f].id,"ignored because it has no nodes");return A={type:"FeatureCollection",features:[]},A.features=A.features.concat(P.features),A.features=A.features.concat(E.features),A.features=A.features.concat(_.features),t.flatProperties&&A.features.forEach(function(e){e.properties=n.merge(e.properties.meta,e.properties.tags,{id:e.properties.type+"/"+e.properties.id})}),A=r(A,!0)}function u(e){var n=t.polygonFeatures;if("function"==typeof n)return n(e);if("no"===e.area)return!1;for(var r in e){var o=e[r],i=n[r];if("undefined"!=typeof i&&"no"!==o){if(i===!0)return!0;if(i.included_values&&i.included_values[o]===!0)return!0;if(i.excluded_values&&i.excluded_values[o]!==!0)return!0}}return!1}t=n.merge({verbose:!1,flatProperties:!1,uninterestingTags:{source:!0,source_ref:!0,"source:ref":!0,history:!0,attribution:!0,created_by:!0,"tiger:county":!0,"tiger:tlid":!0,"tiger:upload_uuid":!0},polygonFeatures:o},t);var l;return l="undefined"!=typeof XMLDocument&&e instanceof XMLDocument||"undefined"==typeof XMLDocument&&e.childNodes?a(e):i(e)},i.toGeojson=i,t.exports=i},{"./lodash.custom.js":2,"./polygon_features.json":6,"geojson-rewind":3}],2:[function(e,t,n){(function(e){(function(){function r(){return M.pop()||[]}function o(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}function i(e){e.length=0,M.length<L&&M.push(e)}function a(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,o=n-t||0,i=Array(0>o?0:o);++r<o;)i[r]=e[t+r];return i}function s(){}function u(e){function t(){if(r){var e=a(r);pt.apply(e,arguments)}if(this instanceof t){var i=c(n.prototype),s=n.apply(i,e||arguments);return A(s)?s:i}return n.apply(o,e||arguments)}var n=e[0],r=e[2],o=e[4];return _t(t,e),t}function l(e,t,n,s,u){if(n){var c=n(e);if("undefined"!=typeof c)return c}var f=A(e);if(!f)return e;var p=st.call(e);if(!G[p]||!xt.nodeClass&&o(e))return e;var d=vt[p];switch(p){case $:case D:return new d(+e);case U:case V:return new d(e);case X:return c=d(e.source,O.exec(e)),c.lastIndex=e.lastIndex,c}var g=jt(e);if(t){var y=!s;s||(s=r()),u||(u=r());for(var m=s.length;m--;)if(s[m]==e)return u[m];c=g?d(e.length):{}}else c=g?a(e):Mt({},e);return g&&(ft.call(e,"index")&&(c.index=e.index),ft.call(e,"input")&&(c.input=e.input)),t?(s.push(e),u.push(c),(g?Ct:Lt)(e,function(e,r){c[r]=l(e,t,n,s,u)}),y&&(i(s),i(u)),c):c}function c(e){return A(e)?mt(e):{}}function f(e,t,n){if("function"!=typeof e)return S;if("undefined"==typeof t||!("prototype"in e))return e;var r=e.__bindData__;if("undefined"==typeof r&&(xt.funcNames&&(r=!e.name),r=r||!xt.funcDecomp,!r)){var o=lt.call(e);xt.funcNames||(r=!I.test(o)),r||(r=B.test(o),_t(e,r))}if(r===!1||r!==!0&&1&r[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)};case 4:return function(n,r,o,i){return e.call(t,n,r,o,i)}}return N(e,t)}function p(e){function t(){var e=l?s:this;if(o){var m=a(o);pt.apply(m,arguments)}if((i||d)&&(m||(m=a(arguments)),i&&pt.apply(m,i),d&&m.length<u))return r|=16,p([n,g?r:-4&r,m,null,s,u]);if(m||(m=arguments),f&&(n=e[y]),this instanceof t){e=c(n.prototype);var h=n.apply(e,m);return A(h)?h:e}return n.apply(e,m)}var n=e[0],r=e[1],o=e[2],i=e[3],s=e[4],u=e[5],l=1&r,f=2&r,d=4&r,g=8&r,y=n;return _t(t,e),t}function d(e,t,n,r,o){(jt(t)?E:Lt)(t,function(t,i){var a,s,u=t,l=e[i];if(t&&((s=jt(t))||Ot(t))){for(var c=r.length;c--;)if(a=r[c]==t){l=o[c];break}if(!a){var f;n&&(u=n(l,t),(f="undefined"!=typeof u)&&(l=u)),f||(l=s?jt(l)?l:[]:Ot(l)?l:{}),r.push(t),o.push(l),f||d(l,t,n,r,o)}}else n&&(u=n(l,t),"undefined"==typeof u&&(u=t)),"undefined"!=typeof u&&(l=u);e[i]=l})}function g(e,t,n,r,o,i){var s=1&t,l=2&t,c=4&t,f=16&t,d=32&t;if(!l&&!x(e))throw new TypeError;f&&!n.length&&(t&=-17,f=n=!1),d&&!r.length&&(t&=-33,d=r=!1);var y=e&&e.__bindData__;if(y&&y!==!0)return y=a(y),y[2]&&(y[2]=a(y[2])),y[3]&&(y[3]=a(y[3])),!s||1&y[1]||(y[4]=o),!s&&1&y[1]&&(t|=8),!c||4&y[1]||(y[5]=i),f&&pt.apply(y[2]||(y[2]=[]),n),d&&gt.apply(y[3]||(y[3]=[]),r),y[1]|=t,g.apply(null,y);var m=1==t||17===t?u:p;return m([e,t,n,r,o,i])}function y(){J.shadowedProps=q,J.array=J.bottom=J.loop=J.top="",J.init="iterable",J.useHas=!0;for(var e,t=0;e=arguments[t];t++)for(var n in e)J[n]=e[n];var r=J.args;J.firstArg=/^[^,]+/.exec(r)[0];var o=Function("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+r+") {\n"+At(J)+"\n}");return o(f,z,ot,ft,T,b,jt,_,J.keys,it,K,wt,V,at,st)}function m(e){return"function"==typeof e&&ut.test(e)}function h(e){var t,n;return!e||st.call(e)!=W||(t=e.constructor,x(t)&&!(t instanceof t))||!xt.argsClass&&b(e)||!xt.nodeClass&&o(e)?!1:xt.ownLast?(Tt(e,function(e,t,r){return n=ft.call(r,t),!1}),n!==!1):(Tt(e,function(e,t){n=t}),"undefined"==typeof n||ft.call(e,n))}function b(e){return e&&"object"==typeof e&&"number"==typeof e.length&&st.call(e)==F||!1}function v(e,t,n,r){return"boolean"!=typeof t&&null!=t&&(r=n,n=t,t=!1),l(e,t,"function"==typeof n&&f(n,r,1))}function w(e){var t=!0;if(!e)return t;var n=st.call(e),r=e.length;return n==R||n==V||(xt.argsClass?n==F:b(e))||n==W&&"number"==typeof r&&x(e.splice)?!r:(Lt(e,function(){return t=!1}),t)}function x(e){return"function"==typeof e}function A(e){return!(!e||!K[typeof e])}function _(e){return"string"==typeof e||e&&"object"==typeof e&&st.call(e)==V||!1}function j(e){var t=arguments,n=2;if(!A(e))return e;if("number"!=typeof t[2]&&(n=t.length),n>3&&"function"==typeof t[n-2])var o=f(t[--n-1],t[n--],2);else n>2&&"function"==typeof t[n-1]&&(o=t[--n]);for(var s=a(arguments,1,n),u=-1,l=r(),c=r();++u<n;)d(e,s[u],o,l,c);return i(l),i(c),e}function E(e,t,n){if(t&&"undefined"==typeof n&&jt(e))for(var r=-1,o=e.length;++r<o&&t(e[r],r,e)!==!1;);else Ct(e,t,n);return e}function P(e){for(var t=-1,n=e?e.length:0,r=[];++t<n;){var o=e[t];o&&r.push(o)}return r}function N(e,t){return arguments.length>2?g(e,17,a(arguments,2),null,t):g(e,1,null,null,t)}function S(e){return e}function C(){}var M=[],T={},L=40,O=/\w*$/,I=/^\s*function[ \n\r\t]+\w/,B=/\bthis\b/,q=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],F="[object Arguments]",R="[object Array]",$="[object Boolean]",D="[object Date]",z="[object Error]",H="[object Function]",U="[object Number]",W="[object Object]",X="[object RegExp]",V="[object String]",G={};G[H]=!1,G[F]=G[R]=G[$]=G[D]=G[U]=G[W]=G[X]=G[V]=!0;var Q={configurable:!1,enumerable:!1,value:null,writable:!1},J={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},K={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Y=K[typeof window]&&window||this,Z=K[typeof n]&&n&&!n.nodeType&&n,et=K[typeof t]&&t&&!t.nodeType&&t,tt=et&&et.exports===Z&&Z,nt=K[typeof e]&&e;!nt||nt.global!==nt&&nt.window!==nt||(Y=nt);var rt=[],ot=Error.prototype,it=Object.prototype,at=String.prototype,st=it.toString,ut=RegExp("^"+String(st).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),lt=Function.prototype.toString,ct=m(ct=Object.getPrototypeOf)&&ct,ft=it.hasOwnProperty,pt=rt.push,dt=it.propertyIsEnumerable,gt=rt.unshift,yt=function(){try{var e={},t=m(t=Object.defineProperty)&&t,n=t(e,e,e)&&t}catch(r){}return n}(),mt=m(mt=Object.create)&&mt,ht=m(ht=Array.isArray)&&ht,bt=m(bt=Object.keys)&&bt,vt={};vt[R]=Array,vt[$]=Boolean,vt[D]=Date,vt[H]=Function,vt[W]=Object,vt[U]=Number,vt[X]=RegExp,vt[V]=String;var wt={};wt[R]=wt[D]=wt[U]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},wt[$]=wt[V]={constructor:!0,toString:!0,valueOf:!0},wt[z]=wt[H]=wt[X]={constructor:!0,toString:!0},wt[W]={constructor:!0},function(){for(var e=q.length;e--;){var t=q[e];for(var n in wt)ft.call(wt,n)&&!ft.call(wt[n],t)&&(wt[n][t]=!1)}}();var xt=s.support={};!function(){var e=function(){this.x=1},t={0:1,length:1},n=[];e.prototype={valueOf:1,y:1};for(var r in new e)n.push(r);for(r in arguments);xt.argsClass=st.call(arguments)==F,xt.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),xt.enumErrorProps=dt.call(ot,"message")||dt.call(ot,"name"),xt.enumPrototypes=dt.call(e,"prototype"),xt.funcDecomp=!m(Y.WinRTError)&&B.test(function(){return this}),xt.funcNames="string"==typeof Function.name,xt.nonEnumArgs=0!=r,xt.nonEnumShadows=!/valueOf/.test(n),xt.ownLast="x"!=n[0],xt.spliceObjects=(rt.splice.call(t,0,1),!t[0]),xt.unindexedChars="x"[0]+Object("x")[0]!="xx";try{xt.nodeClass=!(st.call(document)==W&&!({toString:0}+""))}catch(o){xt.nodeClass=!0}}(1);var At=function(e){var t="var index, iterable = "+e.firstArg+", result = "+e.init+";\nif (!iterable) return result;\n"+e.top+";";e.array?(t+="\nvar length = iterable.length; index = -1;\nif ("+e.array+") {  ",xt.unindexedChars&&(t+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),t+="\n  while (++index < length) {\n    "+e.loop+";\n  }\n}\nelse {  "):xt.nonEnumArgs&&(t+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+e.loop+";\n    }\n  } else {  "),xt.enumPrototypes&&(t+="\n  var skipProto = typeof iterable == 'function';\n  "),xt.enumErrorProps&&(t+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var n=[];if(xt.enumPrototypes&&n.push('!(skipProto && index == "prototype")'),xt.enumErrorProps&&n.push('!(skipErrorProps && (index == "message" || index == "name"))'),e.useHas&&e.keys)t+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",n.length&&(t+="    if ("+n.join(" && ")+") {\n  "),t+=e.loop+";    ",n.length&&(t+="\n    }"),t+="\n  }  ";else if(t+="\n  for (index in iterable) {\n",e.useHas&&n.push("hasOwnProperty.call(iterable, index)"),n.length&&(t+="    if ("+n.join(" && ")+") {\n  "),t+=e.loop+";    ",n.length&&(t+="\n    }"),t+="\n  }    ",xt.nonEnumShadows){for(t+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)t+="\n    index = '"+e.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",e.useHas||(t+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),t+=") {\n      "+e.loop+";\n    }      ";t+="\n  }    "}return(e.array||xt.nonEnumArgs)&&(t+="\n}"),t+=e.bottom+";\nreturn result"};mt||(c=function(){function e(){}return function(t){if(A(t)){e.prototype=t;var n=new e;e.prototype=null}return n||Y.Object()}}());var _t=yt?function(e,t){Q.value=t,yt(e,"__bindData__",Q)}:C;xt.argsClass||(b=function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&ft.call(e,"callee")&&!dt.call(e,"callee")||!1});var jt=ht||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&st.call(e)==R||!1},kt=y({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),Et=bt?function(e){return A(e)?xt.enumPrototypes&&"function"==typeof e||xt.nonEnumArgs&&e.length&&b(e)?kt(e):bt(e):[]}:kt,Pt={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",array:"typeof length == 'number'",keys:Et,loop:"if (callback(iterable[index], index, collection) === false) return result"},Nt={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:Et,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},St={top:"if (!objectTypes[typeof iterable]) return result;\n"+Pt.top,array:!1},Ct=y(Pt),Mt=y(Nt,{top:Nt.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Tt=y(Pt,St,{useHas:!1}),Lt=y(Pt,St);
x(/x/)&&(x=function(e){return"function"==typeof e&&st.call(e)==H});var Ot=ct?function(e){if(!e||st.call(e)!=W||!xt.argsClass&&b(e))return!1;var t=e.valueOf,n=m(t)&&(n=ct(t))&&ct(n);return n?e==n||ct(e)==n:h(e)}:h;s.assign=Mt,s.bind=N,s.compact=P,s.forEach=E,s.forIn=Tt,s.forOwn=Lt,s.keys=Et,s.merge=j,s.each=E,s.extend=Mt,s.clone=v,s.identity=S,s.isArguments=b,s.isArray=jt,s.isEmpty=w,s.isFunction=x,s.isObject=A,s.isPlainObject=Ot,s.isString=_,s.noop=C,s.VERSION="2.4.1",Z&&et&&tt&&((et.exports=s)._=s)}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t){function n(e,t){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(r(n,t)),e;case"Feature":return e.geometry=n(e.geometry,t),e;case"Polygon":case"MultiPolygon":return o(e,t);default:return e}}function r(e,t){return function(n){return e(n,t)}}function o(e,t){return"Polygon"===e.type?e.coordinates=i(e.coordinates,t):"MultiPolygon"===e.type&&(e.coordinates=e.coordinates.map(r(i,t))),e}function i(e,t){t=!!t,e[0]=a(e[0],!t);for(var n=1;n<e.length;n++)e[n]=a(e[n],t);return e}function a(e,t){return s(e)===t?e:e.reverse()}function s(e){return u.ring(e)>=0}var u=e("geojson-area");t.exports=n},{"geojson-area":4}],4:[function(e,t){function n(e){if("Polygon"===e.type)return r(e.coordinates);if("MultiPolygon"===e.type){for(var t=0,n=0;n<e.coordinates.length;n++)t+=r(e.coordinates[n]);return t}return null}function r(e){var t=0;if(e&&e.length>0){t+=Math.abs(o(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(o(e[n]))}return t}function o(e){var t=0;if(e.length>2){for(var n,r,o=0;o<e.length-1;o++)n=e[o],r=e[o+1],t+=i(r[0]-n[0])*(2+Math.sin(i(n[1]))+Math.sin(i(r[1])));t=t*a.RADIUS*a.RADIUS/2}return t}function i(e){return e*Math.PI/180}var a=e("wgs84");t.exports.geometry=n,t.exports.ring=o},{wgs84:5}],5:[function(e,t){t.exports.RADIUS=6378137,t.exports.FLATTENING=1/298.257223563,t.exports.POLAR_RADIUS=6356752.3142},{}],6:[function(e,t){t.exports={building:!0,highway:{included_values:{services:!0,rest_area:!0,escape:!0}},natural:{excluded_values:{coastline:!0,ridge:!0,arete:!0,tree_row:!0}},landuse:!0,waterway:{included_values:{riverbank:!0,dock:!0,boatyard:!0,dam:!0}},amenity:!0,leisure:!0,barrier:{included_values:{city_wall:!0,ditch:!0,hedge:!0,retaining_wall:!0,wall:!0,spikes:!0}},railway:{included_values:{station:!0,turntable:!0,roundhouse:!0,platform:!0}},area:!0,boundary:!0,man_made:{excluded_values:{cutline:!0,embankment:!0,pipeline:!0}},power:{included_values:{plant:!0,substation:!0,generator:!0,transformer:!0}},place:!0,shop:!0,aeroway:{excluded_values:{taxiway:!0}},tourism:!0,historic:!0,public_transport:!0,office:!0,"building:part":!0,military:!0,ruins:!0,"area:highway":!0,craft:!0,golf:!0}},{}]},{},[1])(1)}),function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Spinner=t()}(this,function(){"use strict";function e(e,t){var n,r=document.createElement(e||"div");for(n in t)r[n]=t[n];return r}function t(e){for(var t=1,n=arguments.length;n>t;t++)e.appendChild(arguments[t]);return e}function n(e,t,n,r){var o=["opacity",t,~~(100*e),n,r].join("-"),i=.01+n/r*100,a=Math.max(1-(1-e)/t*(100-i),e),s=l.substring(0,l.indexOf("Animation")).toLowerCase(),u=s&&"-"+s+"-"||"";return f[o]||(p.insertRule("@"+u+"keyframes "+o+"{0%{opacity:"+a+"}"+i+"%{opacity:"+e+"}"+(i+.01)+"%{opacity:1}"+(i+t)%100+"%{opacity:"+e+"}100%{opacity:"+a+"}}",p.cssRules.length),f[o]=1),o}function r(e,t){var n,r,o=e.style;if(void 0!==o[t])return t;for(t=t.charAt(0).toUpperCase()+t.slice(1),r=0;r<c.length;r++)if(n=c[r]+t,void 0!==o[n])return n}function o(e,t){for(var n in t)e.style[r(e,n)||n]=t[n];return e}function i(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)void 0===e[r]&&(e[r]=n[r])}return e}function a(e){for(var t={x:e.offsetLeft,y:e.offsetTop};e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function s(e){return"undefined"==typeof this?new s(e):void(this.opts=i(e||{},s.defaults,d))}function u(){function n(t,n){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',n)}p.addRule(".spin-vml","behavior:url(#default#VML)"),s.prototype.lines=function(e,r){function i(){return o(n("group",{coordsize:l+" "+l,coordorigin:-u+" "+-u}),{width:l,height:l})}function a(e,a,s){t(f,t(o(i(),{rotation:360/r.lines*e+"deg",left:~~a}),t(o(n("roundrect",{arcsize:r.corners}),{width:u,height:r.width,left:r.radius,top:-r.width>>1,filter:s}),n("fill",{color:r.color,opacity:r.opacity}),n("stroke",{opacity:0}))))}var s,u=r.length+r.width,l=2*u,c=2*-(r.width+r.length)+"px",f=o(i(),{position:"absolute",top:c,left:c});if(r.shadow)for(s=1;s<=r.lines;s++)a(s,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(s=1;s<=r.lines;s++)a(s);return t(e,f)},s.prototype.opacity=function(e,t,n,r){var o=e.firstChild;r=r.shadow&&r.lines||0,o&&t+r<o.childNodes.length&&(o=o.childNodes[t+r],o=o&&o.firstChild,o=o&&o.firstChild,o&&(o.opacity=n))}}var l,c=["webkit","Moz","ms","O"],f={},p=function(){var n=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],n),n.sheet||n.styleSheet}(),d={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};s.defaults={},i(s.prototype,{spin:function(t){this.stop();var n,r,i=this,s=i.opts,u=i.el=o(e(0,{className:s.className}),{position:s.position,width:0,zIndex:s.zIndex}),c=s.radius+s.length+s.width;if(t&&(t.insertBefore(u,t.firstChild||null),r=a(t),n=a(u),o(u,{left:("auto"==s.left?r.x-n.x+(t.offsetWidth>>1):parseInt(s.left,10)+c)+"px",top:("auto"==s.top?r.y-n.y+(t.offsetHeight>>1):parseInt(s.top,10)+c)+"px"})),u.setAttribute("role","progressbar"),i.lines(u,i.opts),!l){var f,p=0,d=(s.lines-1)*(1-s.direction)/2,g=s.fps,y=g/s.speed,m=(1-s.opacity)/(y*s.trail/100),h=y/s.lines;!function b(){p++;for(var e=0;e<s.lines;e++)f=Math.max(1-(p+(s.lines-e)*h)%y*m,s.opacity),i.opacity(u,e*s.direction+d,f,s);i.timeout=i.el&&setTimeout(b,~~(1e3/g))}()}return i},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(r,i){function a(t,n){return o(e(),{position:"absolute",width:i.length+i.width+"px",height:i.width+"px",background:t,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/i.lines*u+i.rotate)+"deg) translate("+i.radius+"px,0)",borderRadius:(i.corners*i.width>>1)+"px"})}for(var s,u=0,c=(i.lines-1)*(1-i.direction)/2;u<i.lines;u++)s=o(e(),{position:"absolute",top:1+~(i.width/2)+"px",transform:i.hwaccel?"translate3d(0,0,0)":"",opacity:i.opacity,animation:l&&n(i.opacity,i.trail,c+u*i.direction,i.lines)+" "+1/i.speed+"s linear infinite"}),i.shadow&&t(s,o(a("#000","0 0 4px #000"),{top:"2px"})),t(r,t(s,a(i.color,"0 0 1px rgba(0,0,0,.1)")));return r},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}});var g=o(e("group"),{behavior:"url(#default#VML)"});return!r(g,"transform")&&g.adj?u():l=r(g,"animation"),s}),function(){var e,t,n,r,o,i,a,s,u,l;n=function(e,t,n){if(null==t&&(t={}),"function"==typeof t&&(n=t,t={}),t.limit||(t.limit=10),t.radius||(t.radius=1e4),t.language||(t.language="en"),t.radius>1e4)throw new Error("radius cannot be greater than 10000");if(t.limit>500)throw new Error("limit cannot be greater than 500");return l(e,t,n)},l=function(e,n,r,o,i){var a,u,c,f,p;if(p="http://"+n.language+".wikipedia.org/w/api.php",f={action:"query",prop:"info|coordinates",generator:"geosearch",ggsradius:n.radius,ggscoord:""+e[1]+"|"+e[0],ggslimit:n.limit,format:"json"},n.images&&(f.prop+="|pageprops"),n.summaries&&(f.prop+="|extracts",f.exlimit="max",f.exintro=1,f.explaintext=1),n.templates&&(f.prop+="|templates",f.tllimit=500),n.categories&&(f.prop+="|categories",f.cllimit=500),a={extracts:"excontinue",coordinates:"cocontinue",templates:"tlcontinue",categories:"clcontinue"},i)for(u in a)c=a[u],i[u]&&(f[c]=i[u][c]);return console.log("fetching results from wikipedia api"),t(p,{params:f},function(t){var f,p,d,g,y,m,h;if(o||(d=!0,o=t),{"else":d=!1},!t.query||!t.query.pages)return void s(o,n,r);h=t.query.pages;for(p in h)if(f=h[p],m=o.query.pages[p])for(y in a)c=a[y],"extracts"===y&&(y="extract"),g=f[y],g&&(Array.isArray(g)?m[y]?d||m[y][-1]===g[-1]||(m[y]=m[y].concat(g)):m[y]=g:m[y]=f[y]);if(t["query-continue"]){if(i)for(u in a)c=a[u],t["query-continue"][u]&&(i[u]=t["query-continue"][u]);else i=t["query-continue"];return l(e,n,r,o,i)}return s(o,n,r)})},s=function(e,t,n){var r,o,i,s,u,l,c,f;if(s={type:"FeatureCollection",features:[]},!(e&&e.query&&e.query.pages))return void n(s);f=e.query.pages;for(o in f)r=f[o],r.coordinates&&(l=r.title.replace(/\s/g,"_"),c="http://"+t.language+".wikipedia.org/wiki/"+l,i={id:c,type:"Feature",properties:{name:r.title},geometry:{type:"Point",coordinates:[Number(r.coordinates[0].lon),Number(r.coordinates[0].lat)]}},t.images&&(u=r.pageprops?r.pageprops.page_image:null,i.properties.image=u),t.templates&&(i.properties.templates=a(r.templates)),t.summaries&&(i.properties.summary=r.extract),t.categories&&(i.properties.categories=a(r.categories)),s.features.push(i));n(s)},a=function(e){var t;return function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],o.push(t.title.replace(/^.+?:/,""));return o}()},u=function(e,t,n){return r(e,{qs:t.params,json:!0},function(e,t,r){return n(r)})},i=function(e,t,n){return $.ajax({url:e,data:t.params,dataType:"jsonp",success:function(e){return n(e)}})};try{r=require("request"),t=u}catch(c){e=c,t=i}o="undefined"!=typeof exports&&null!==exports?exports:this,o.geojson=n}.call(this);